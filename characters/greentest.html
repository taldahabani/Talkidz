<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Green Screen Removal</title>
<style>
  body {
    margin: 0;
    padding: 0;
    /* Adjust background image path, and ensure it is accessible */
    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover;
    overflow: hidden;
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }

  /* Optional: If you need the canvas or video to fill the screen, you might need:
     html, body {
       width: 100%;
       height: 100%;
     } 
     canvas {
       width: 100vw;
       height: 100vh;
     }
  */
</style>
</head>
<body>

<video id="video" src="character.mp4" autoplay muted playsinline loop style="display:none;"></video>
<canvas id="canvas"></canvas>

<script>
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  video.addEventListener('loadeddata', () => {
    // Set canvas size to video size
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    drawFrame();
  });

  function drawFrame() {
    // Draw the current frame of the video onto the canvas
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Extract pixel data
    const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = frame.data;

    // Adjust tolerance values as needed to remove green
    const greenTolerance = 80; // tweak this
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i];
      const g = data[i + 1];
      const b = data[i + 2];

      // Simple chroma key detection: check if pixel is "green enough"
      // We look if green is significantly higher than red and blue
      if ((g - r > greenTolerance) && (g - b > greenTolerance)) {
        data[i + 3] = 0; // set alpha to 0
      }
    }

    // Put the processed image data back onto the canvas
    ctx.putImageData(frame, 0, 0);

    // Schedule next frame
    requestAnimationFrame(drawFrame);
  }

  // If the video doesn't autoplay on mobile, you may need a user interaction:
  // document.body.addEventListener('click', () => {
  //   video.play();
  // });

</script>
</body>
</html>
